PHP 学習ログ
---
- php での web アプリ開発の勉強記録．
- ```Laravel Framework 7.13.0``` 使用．
- Markdown 記法の練習にもなれば．．．

## ルール
- 毎日やる
- 行ったことを具体的に記述する．

## 5/27
- やったこと
    - php 環境構築
    - composer のインストール， laravel のインストール
    - composer create-project laravel/laravel "プロジェクト名"でフォルダ作成
- できなかったこと
    - https://qiita.com/yamato3310/items/fbef9f5cc450d69db156 を参考に作成したけど，localhostでアクセスできず．
- 明日の todo
    - ブックマークしてるphp入門できそうな気がするからやってみる．

## 5/28
- やったこと
    - https://www.hypertextcandy.com/laravel-tutorial-todo-app-list-folders
        - ↑に`http://todos/~~にアクセスすると~`みたいな感じで書いてるが，おそらく環境が違うため，できない．
        - ↑　`php artisan serve` すると可能
    - qiita みながら mysql インストール，DB 作成
    - migration で詰まったけど， .env の password が secred になってただけやった．設定したユーザ，パスで通った．
- できなかったこと
    - migration の考え方がわからなかった．(テーブルの定義ということ？)
    - テストデータの挿入．sequal pro で DB みようとしてもみれない．
- 明日の todo 
    - sequal pro のエラー解決，[php入門](https://www.hypertextcandy.com/laravel-tutorial-todo-app-list-folders) 続ける
    
## 5/29
- やったこと
    - > テストデータの挿入．sequal pro で DB みようとしてもみれない．
        - sequel pro は mysql 8.x に対応してないらしい．
            - DBeaver で同じことしたら，見れた．
    - > sequal pro のエラー解決 
        - table 名が間違ってた．db 再度作成， migration で解決．

## 5/30
- やったこと
    - tutorial の続き．
        - blade.php のファイルで参考演算子を用いて読み込む css 変えててすごかった．(チュートリアル (3) の最後らへん)
        - アクセサで css クラスも定義するのすごい便利．
    - > migration の考え方がわからなかった．(テーブルの定義ということ？)
        - [公式 DOC](https://readouble.com/laravel/5.7/ja/migrations.html)
- できなかったこと
    - 外部キー, migration がいまいちワカラン
    - SQL の基礎 where とかなんとか

## 5/31
- やったこと
    - クロスサイトリクエストフォージェリ対策について．
    - MVC モデルの理解．(理解できてる気がしてきた．)
        - データベース周りに関してはイマイチわかってない．
- 明日の todo
    - (5)入力値バリデーションから．

## 6/1
- やったこと
    - 入力値バリデーションの方法
        - Http/Request/ に make:Request して，コントローラの該当変数の型を作成した Request の Class 名に変更する．
    - エラーメッセージの言語変更
        - config/lang に jp を mkdir して， en 内の validation.php をコピーし，該当箇所を変更する．
    - 入力値の復元，バリデーションエラー発生時に入力値をセッション情報をもとに復元した
        - 関数 old で簡単に実装可能．
        - 地味な機能だが，結構大事な気がする．
    - js flatpickr でカレンダー型の日付選択フォーム実装．
        - js 自体よくわかってないので，ふわっと雰囲気だけ理解
        - めちゃくちゃみやすいからこういう機会があれば活用したい．
    - layout ファイルの作成．
        - ページごとに変化する箇所は yield にする
        - これはマジで便利．レイアウトを統一したいときとかコードの量が圧倒的に減る．セクション区切りに記述するからみやすい．
- 明日の todo
    - (6)タスクを保存する から．

## 6/2
- やったこと
    - message メソッドで個別の(エラー)メッセージを設定
        - validation.php と message メソッドがややこしい．
    - current_folder_id がどここらきたのかわからなかったけど，そもそも url に適当な id を入力する前提で進んでるので，もともとは打ち込むところからきてる．
        - 同じ要領で後にも task_id ってやつがでてくるけど，これも直接 URL に打ち込んでる想定なので，この時点では定義されたりしてない．
            - (こうやって開発進めていくのが普通なのか？？？)
    - テストケースの生成，通常のフォームからでは入力できない値を入力した時の挙動をチェックする．
        - UI からでなく，コマンドから post されたとき対策だと思うが， validation の日本語とテストケースのレスポンスが完全一致してないとダメ．(当然だけども．)
        - 空白一個とかも許されないので，ちょっとめんどくさいと感じたんだけど，もっと良い方法あるのかな？
- できなかったこと
    - リレーションの考え方がわからない．
    - vscode で　\~.blade.php を編集する時，見た目が崩れる．
        - アロー演算子(->) を html タグの一部と誤認識する．
        - 多分，vscode の json いじれば解決できそう．
- **今後やりたいこと**
    - 勉強時間管理アプリを作りたい
        - この勉強ログに勉強時間も記録したいと思ったけど，ちょっと面倒．
        - php tutorial 終了したら，勉強時間管理アプリつくって，そこで時間管理する．
            - なんやったら，このログもそこで管理したらいいのでは
- 明日の todo
    - (7) テンプレートを部品化する．から．

## 6/3
- やったこと
    - @include で共通部分の読み込み
        - これ \<head> でスクリプト読むのとどう違うのか．長くなってる気がするが．
    - EditTask を作って動作確認するとこでエラー出たけど， 
        ```
        use App\Http\Requests\EditTask;
        ```
        追加で解決．
    - テストケースの作成が相変わらずめんどくさい．半角の空白のポジションで怒られた．
        - メッセージは決めた template に沿わせて一意に決定されるようにしたほうがいい
    - migration に関して
        - up = migrate したときに実行される処理
        - down = ロールバックした時に実行される処理
    - User の概念を DB に追加する時，migration を利用して user_id をテーブルに追加するが，既存のデータには user_id はもちろん定義されていないので migration error となる
        - 既存のデータに not null 制約が追加されたため発生したエラー．
        - migrate:fresh して，追加 table のサンプルデータを seeder につめて
        ```
        php artisan db:seed --class=シーダー名
        ```
        することで解決．
        - 今まで作ったシーダーを全て実行しないとダメ！
    - ```
        Please install the laravel/ui package in order to use the Auth::routes() method.
      ```
      ↑ laravel/ui パッケージがインポートされてなかったみたい．解決
    - register 画面を作る場面で Http/Auth/ ディレクトリまるごとないことに気づく．
        - 原因はわからないが，おそらくバージョンの違い [参考](https://qiita.com/daisu_yamazaki/items/a914a16ca1640334d7a5)
        - ```
            php artisan ui vue --auth
            ```
            で対応した．おそらく解決した．
- できなかったこと
    - PHP の基本でわかってない部分がある．
        - rule in (?) とか :: とか
- **PHP について勉強した**
    - .(ドット) は文字列の連結に使う．
    - [Qiita PHP入門](https://qiita.com/mackeyTA/items/069900b5c2366fb30e3a#%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%AE%E4%BD%9C%E6%88%90) がものすごく参考になる．
- 明日の todo
    - session 情報削除の方法がわからんくて，ログアウトできなかった．(ログアウト機能が未実装なため．)

## 6/4
- やったこと
    - ```Auth``` クラスの```check```メソッドでログインしてるか確認．ログインしてる場合は```Auth::check()```は```true```
        - if でログインしてるときとしてない時の表示を切り替える
    - ```Auth::user()```はログインユーザーの情報が入ったインスタンスが帰る
    - ログイン認証は必須で，ページ表示前にログインさせる必要があるため，ミドルウェアでログイン認証を行った
        - ルートグループで今までのルーティング情報をまとめて，遷移するしないの以前に認証する
        - この```'Auth'```は```app/Http/Kernel.php```で定義されてる．
        - 未ログインの場合ログイン画面にリダイレクト
    - (モデルはデフォルトでは App  直下に生成されるが， Models とかのディレクトリを作成して格納するのがベターらしい．たしかに多くなると見辛い．)
        - 当然それにともなって namespace とかも変更しないとダメ．
        - [参考](https://www.hypertextcandy.com/send-email-with-laravel#%E9%80%81%E4%BF%A1%E8%A8%AD%E5%AE%9A)
    - validation 最後の attributes は空欄になってるが，追加するとアプリ内すべてで適応される
    - エラーハンドリングで abort 関数を利用する際， is_null で 404 を表示させるタイミングは考えないとダメ，(まあ当然,ガード節みたいな感じ)
- 明日の todo
    - ルートモデルバインディングでわからんくなってしまった．
        - 資料にミスがあるっぽいので，それを避けて実装．
        - そもそもルートモデルバインディング is 何ってとこから始める．

## 6/5
- やったこと
    - > 資料にミスがあるっぽいので，それを避けて実装．
        - laravel 5.x では資料と同様でも動いたらしいが，7.x ではクラッシュするっぽい
        - 要するに，```id```から```folder```を検索してたのに対して，モデルのインスタンス```Folder```を受け取ることでルート(URI の id の部分)とモデルを結びつけて考えてくれる機能らしい．
        - この資料では後から変更を加えたために，```index.tasks```に関係する部分全ての引数を変更する必要が生じた
            - これ，実際に何か作る時には慎重に行ったほうが良い．
            - 改修箇所とそうでなくても良い箇所がごちゃごちゃになる
            - (key を指定しなくても良いといった書き込みもあった．[参考](https://teratail.com/questions/240242))
    - ポリシークラスを作成し，```AuthServiceprovider```に登録(モデルとポリシーを結びつける)．今の場合は，```Folder```クラスの処理の許可は```FolderPolicy```が管理してるよ．の意味．
        - ```web.php```でポリシーへの引数，(URI のどこを引数とするのかと，ポリシー内のどの関数を使用するのか)を定義する．(説明しにくい．)[チュートリアル](https://www.hypertextcandy.com/laravel-tutorial-error-handling/)
    - 認証と認可
        - このチュートリアルではまずユーザ認証し，次いで予期しない URL にアクセスさせないために，認可 基準を設けている．
    - 使用したエラーコード
        |コード|意味|
        |:---:|:---:|
        |403|権限がない時のエラー|
        |404|not found 見つかりません|
        |500|サーバーエラー(システムエラー)|
- **tutorial 終了**
    - heroku にデプロイは目的ではないのでスルーする．
- 感想
    - よかった点
        - Laravel を通して MVC モデルの理解を深めた．
        - アクセサ，html の部品化，ルートモデルバインディングなど，使いこなせれば便利な機能がたくさんある．
        - Auth, Password Reset など超簡単に実装できた．
    - 微妙だった点
        - ファイル間の関係がややこしく感じることがあった．
            - これは慣れてないことが原因だと思う．管理部分を明確に分離することが MVC モデルの目的でもあると思うので，仕組みに慣れる
        - アプリを作る前に，ルーティング，モデルなどはイメージを持っておかないと改修がめんどくさい．